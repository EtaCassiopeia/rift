# Rift Demo - HTTPS/TLS Mode
#
# Prerequisites:
#   1. Build the local image:
#      docker build -t rift-proxy:local -f crates/rift-http-proxy/Dockerfile .
#
#   2. Generate certificates:
#      ./generate-certs.sh
#
# Quick Start:
#   docker compose -f docker-compose-https.yml up -d
#   curl --cacert certs/ca.crt https://localhost:4545/api/test
#
# This demo shows Rift's TLS support:
# - HTTPS listener with custom certificates
# - All fault injection features work over TLS
# - Uses Mountebank format with _rift extensions

services:
  rift:
    image: rift-proxy:local
    container_name: rift-https-demo
    ports:
      - "2525:2525"    # Admin API
      - "4545:4545"    # HTTPS Imposter
      - "9091:9090"    # Metrics (HTTP)
    environment:
      - RUST_LOG=info
      - MB_ALLOW_INJECTION=true
    volumes:
      - ./imposters-https.json:/imposters.json:ro
      - ./certs:/certs:ro
    command: ["--configfile", "/imposters.json"]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9090/metrics"]
      interval: 10s
      timeout: 5s
      retries: 3
